<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>신(新) 만세력 — sinsaju calculator</title>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&family=Noto+Serif+KR:wght@400;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="css/main.css">
</head>
<body>
  <div class="app">
    <header class="app-header">
      <h1>신<span class="accent">新</span> 만세력</h1>
      <p class="subtitle">연속 함수 기반 사주 분석기</p>
    </header>

    <!-- Tab Navigation -->
    <nav class="tab-nav">
      <button class="tab-btn active" data-tab="single">개인 분석</button>
      <button class="tab-btn" data-tab="gunghap">궁합</button>
    </nav>

    <!-- ============ Single Person Tab ============ -->
    <section id="tab-single" class="tab-content active">
      <div class="input-section">
        <form id="saju-form" class="saju-form">
          <div class="form-row">
            <div class="form-group">
              <label>년</label>
              <input type="number" id="in-year" min="1900" max="2100" placeholder="1990">
            </div>
            <div class="form-group">
              <label>월</label>
              <input type="number" id="in-month" min="1" max="12" placeholder="1">
            </div>
            <div class="form-group">
              <label>일</label>
              <input type="number" id="in-day" min="1" max="31" placeholder="15">
            </div>
            <div class="form-group">
              <label>시</label>
              <input type="number" id="in-hour" min="0" max="23" placeholder="14">
            </div>
            <div class="form-group">
              <label>분</label>
              <input type="number" id="in-min" min="0" max="59" placeholder="30">
            </div>
          </div>
          <div class="form-row form-row-options">
            <div class="form-group gender-group">
              <label>성별</label>
              <div class="radio-group">
                <label class="radio-label"><input type="radio" name="gender" value="m" checked> 남</label>
                <label class="radio-label"><input type="radio" name="gender" value="f"> 여</label>
              </div>
            </div>
            <div class="form-group calendar-group">
              <label>달력</label>
              <div class="radio-group">
                <label class="radio-label"><input type="radio" name="calendar" value="solar" checked> 양력</label>
                <label class="radio-label"><input type="radio" name="calendar" value="lunar"> 음력</label>
              </div>
            </div>
            <div class="form-group country-group">
              <label>국가</label>
              <select id="in-country" class="city-select">
                <option value="한국" selected>한국</option>
                <option value="일본">일본</option>
                <option value="중국">중국</option>
                <option value="대만">대만</option>
                <option value="미국 동부">미국 동부</option>
                <option value="미국 중부">미국 중부</option>
                <option value="미국 서부">미국 서부</option>
                <option value="영국">영국</option>
                <option value="독일">독일</option>
                <option value="프랑스">프랑스</option>
                <option value="캐나다">캐나다</option>
              </select>
            </div>
            <div class="form-group city-group">
              <label>출생지</label>
              <select id="in-city" class="city-select">
                <option value="">직접 입력</option>
                <option value="126.98" selected>서울</option>
                <option value="129.08">부산</option>
                <option value="128.60">대구</option>
                <option value="126.71">인천</option>
                <option value="126.85">광주</option>
                <option value="127.38">대전</option>
                <option value="129.31">울산</option>
                <option value="127.01">세종</option>
                <option value="126.53">제주</option>
                <option value="127.01">수원</option>
                <option value="128.68">창원</option>
                <option value="127.15">전주</option>
                <option value="127.49">청주</option>
                <option value="127.73">춘천</option>
                <option value="129.37">포항</option>
              </select>
            </div>
            <div class="form-group longitude-group">
              <label>경도</label>
              <input type="number" id="in-longitude" step="0.01" value="126.98" min="-180" max="180">
            </div>
          </div>
          <button type="submit" class="btn-calculate">분석하기</button>
        </form>
      </div>

      <section id="results" class="results-section" style="display:none;">
        <div id="correction-info" class="correction-info" style="display:none;"></div>

        <!-- 사주 4기둥 + 운세 기둥 -->
        <div class="pillar-display-row" id="pillar-display-row">
          <div id="fe-fortune-pillars" class="pillar-container fe-fortune-pillar-area" style="display:none"></div>
          <div id="pillar-display" class="chart-container pillar-container"></div>
        </div>

        <!-- 신 사주 차트 (사주명식 바로 아래) -->
        <div class="chart-panel" id="fortune-explorer-wrapper" style="display:none">
          <h3 class="chart-title">신 사주 차트</h3>
          <div id="fortune-explorer"></div>
        </div>


        <!-- 천간 오행 파형 -->
        <div class="chart-panel waveform-panel">
          <h3 class="chart-title">천간 오행 파형</h3>
          <div id="cheongan-waveform" class="waveform-chart-container"></div>
          <div class="chart-desc chart-desc-inner">
            <p>X축 = 10천간(甲~癸), Y축 = 오행 에너지(0~1.0). 갑을 = 목, 병정 = 화, 무기 = 토, 경신 = 금, 임계 = 수. 5개 곡선은 각 천간 쌍의 중심에서 cos² 피크를 이루며, 지지와 달리 <strong>대립 관계가 아닌 순환적 배치</strong>입니다. <strong>4개 수직 점선</strong>이 각각 년주(<span style="color:#E88AED">분홍</span>) / 월주(<span style="color:#34C759">녹</span>) / 일주(<span style="color:#FFD700">금</span>) / 시주(<span style="color:#0071E3">청</span>)의 천간 위치입니다.</p>
            <p style="margin-top:8px; padding:8px 12px; background:#f5f0e0; border-radius:6px; font-size:0.92em; color:#665500;"><strong>주의:</strong> 천간의 토(戊己)와 지지의 토(丑辰未戌)는 보이는 성질이 비슷할 수 있지만, 아예 다른 곳에서 나온 성질이므로 같은 개념으로 봐서는 안 됩니다.</p>
          </div>
        </div>

        <!-- 지지 오행 파형 차트 (전체 폭, 년월일시 동시 표시) -->
        <div class="chart-panel waveform-panel">
          <h3 class="chart-title">지지 오행 파형</h3>
          <div id="waveform-chart" class="waveform-chart-container"></div>
          <div class="chart-desc chart-desc-inner">
            <p>X축 = 각도(寅~丑, 12지지 영역), Y축 = 오행 에너지(0~1.0). 4개 곡선이 <strong>목(卯)↔금(酉), 화(午)↔수(子)</strong> 상극 관계를 cos² 삼각함수로 보여줍니다. <strong>세로 경계선</strong>이 12지지 각 영역을 구분합니다. 아래 <strong>토 그래프</strong>는 왕지(자묘오유) 75% 지점부터 역마(인사신해) 중심까지의 전환 구간에서 토의 강도(최대 0.7)를 표시합니다. 토는 독립 원소가 아닌 오행 전환(화개) 구간의 성질입니다. <strong>지장간 비율표</strong>가 12지지별 숨은 천간의 구성 비율을 보여줍니다. <strong>4개 수직 점선</strong>이 각각 년주(<span style="color:#E88AED">분홍</span>) / 월주(<span style="color:#34C759">녹</span>) / 일주(<span style="color:#FFD700">금</span>) / 시주(<span style="color:#0071E3">청</span>)의 출생 각도입니다.</p>
          </div>
        </div>

        <!-- 운세 시계열 그래프 -->
        <div class="chart-panel waveform-panel">
          <h3 class="chart-title">운세에 따른 오행/십성 변화</h3>
          <div class="fortune-ts-controls">
            <button class="ts-mode-btn active" data-mode="oheng">오행</button>
            <button class="ts-mode-btn" data-mode="sipsung">십성</button>
          </div>
          <div id="fortune-timeseries-chart" class="waveform-chart-container"></div>
          <div class="chart-desc chart-desc-inner">
            <p>X축 = 연도, Y축 = 비율(%). <strong>점선</strong> = 사주원국 기준값, <strong>실선</strong> = 대운+세운 반영값. 수직 점선 = 대운 경계. 대운이 바뀔 때마다 기본 오행 구성이 변하고, 세운(매년)에 따라 미세하게 변동합니다. 합충 발생 연도에는 X축 위에 마커(녹=합, 적=충)가 표시됩니다. 마우스를 올리면 해당 연도의 상세 정보를 확인할 수 있습니다.</p>
          </div>
        </div>

        <!-- 대운 10년 상세 그래프 -->
        <div class="chart-panel waveform-panel">
          <div class="detail-chart-header">
            <h3 class="chart-title">대운 상세 (10년)</h3>
            <div class="detail-nav">
              <button class="detail-nav-btn" id="decade-prev">&#9664;</button>
              <span class="detail-nav-label" id="decade-label">—</span>
              <button class="detail-nav-btn" id="decade-next">&#9654;</button>
            </div>
          </div>
          <div id="fortune-decade-chart" class="waveform-chart-container"></div>
        </div>

        <!-- 연간 월별 상세 그래프 -->
        <div class="chart-panel waveform-panel">
          <div class="detail-chart-header">
            <h3 class="chart-title">연간 상세 (12개월)</h3>
            <div class="detail-nav">
              <button class="detail-nav-btn" id="year-prev">&#9664;</button>
              <span class="detail-nav-label" id="year-label">—</span>
              <button class="detail-nav-btn" id="year-next">&#9654;</button>
            </div>
          </div>
          <div id="fortune-year-chart" class="waveform-chart-container"></div>
        </div>
      </section>
    </section>

    <!-- ============ Gunghap Tab ============ -->
    <section id="tab-gunghap" class="tab-content" style="display:none;">
      <div class="input-section gunghap-input-section">
        <div class="gunghap-forms">
          <div class="gunghap-person">
            <h4 class="gunghap-person-label">A</h4>
            <div class="form-row">
              <div class="form-group"><label>년</label><input type="number" id="gA-year" min="1900" max="2100" placeholder="1990"></div>
              <div class="form-group"><label>월</label><input type="number" id="gA-month" min="1" max="12" placeholder="1"></div>
              <div class="form-group"><label>일</label><input type="number" id="gA-day" min="1" max="31" placeholder="15"></div>
              <div class="form-group"><label>시</label><input type="number" id="gA-hour" min="0" max="23" placeholder="14"></div>
              <div class="form-group"><label>분</label><input type="number" id="gA-min" min="0" max="59" placeholder="30"></div>
            </div>
            <div class="form-row form-row-options">
              <div class="form-group gender-group">
                <label>성별</label>
                <div class="radio-group">
                  <label class="radio-label"><input type="radio" name="gA-gender" value="m" checked> 남</label>
                  <label class="radio-label"><input type="radio" name="gA-gender" value="f"> 여</label>
                </div>
              </div>
            </div>
          </div>
          <div class="gunghap-person">
            <h4 class="gunghap-person-label">B</h4>
            <div class="form-row">
              <div class="form-group"><label>년</label><input type="number" id="gB-year" min="1900" max="2100" placeholder="1992"></div>
              <div class="form-group"><label>월</label><input type="number" id="gB-month" min="1" max="12" placeholder="3"></div>
              <div class="form-group"><label>일</label><input type="number" id="gB-day" min="1" max="31" placeholder="20"></div>
              <div class="form-group"><label>시</label><input type="number" id="gB-hour" min="0" max="23" placeholder="8"></div>
              <div class="form-group"><label>분</label><input type="number" id="gB-min" min="0" max="59" placeholder="0"></div>
            </div>
            <div class="form-row form-row-options">
              <div class="form-group gender-group">
                <label>성별</label>
                <div class="radio-group">
                  <label class="radio-label"><input type="radio" name="gB-gender" value="m"> 남</label>
                  <label class="radio-label"><input type="radio" name="gB-gender" value="f" checked> 여</label>
                </div>
              </div>
            </div>
          </div>
        </div>
        <button type="button" id="gunghap-btn" class="btn-calculate">궁합 분석</button>
      </div>

      <section id="gunghap-results" class="results-section" style="display:none;">
        <div id="gunghap-display" class="gunghap-display"></div>
        <div class="chart-desc">
          <p class="chart-desc-title">궁합 분석 해석 방법</p>
          <p><strong>기둥별 각도 호환성:</strong> 두 사람의 시주/월주/년주 각도 차이를 측정합니다. 각도가 가까울수록(0~15도) 같은 기운을 공유하는 "합"이고, 180도에 가까울수록 정반대 기운인 "충"입니다. 기존 만세력처럼 합/충을 이진(있다/없다)으로 보지 않고, 연속적인 정도로 측정하는 것이 핵심입니다.</p>
          <p style="margin-top:6px"><strong>오행 보완 분석:</strong> 한 사람에게 부족한 오행을 상대가 채워주면 "보완"(좋음), 둘 다 비슷하면 "조화", 둘 다 부족하면 "공통 부족"(주의)입니다.</p>
        </div>
      </section>
    </section>
  </div>

  <script src="js/lib/sajuwiki/korean-lunar-calendar.min.js"></script>
  <script type="module" src="js/app.js"></script>
</body>
</html>
